(function(){APPMarket.Frontend.FrontendApp.controller("AppsController",["$scope","$rootScope","$timeout","$filter","blockUI","ApiFactory","ListingService","SystemFactory","SweetAlertService","UploaderFactory",function(e,a,t,i,s,r,n,o,l,p){var d;return new(d=function(){function n(){e.resources=APPMarket.Resources,e.vars=APPMarket.Vars,e.link={root:e.resources.root,submitapps_list:e.resources.submitapps_list,lists:e.resources.index,app_update:e.resources.app_update,app_version_update:e.resources.app_version_update,app_search:e.resources.app_search,app_import:e.resources.app_import,app_android_detail:e.resources.app_android_detail,app_remove_upload:e.resources.app_remove_upload,app_remove_apk:e.resources.app_remove_apk},e.blockUI=e.blockui("blockui-effect"),e.details={},e.uploads={},e.categories=e.vars.categories,e.apkFile=e.apkFiles={app_version:"",signature:"",sha_1:"",description:"",app_link:"",file:{}},e.details={image_app:{},screenshots:[],is_enabled:!0,app_id:"",title:"",description:"",image_url:"",link:"",developer_link:"",developer_name:"",apk_files:[],versions:[]},0===e.vars.is_create&&e.getDetail()}var d,u,c,k;return e.getDetail=function(){return e.blockUI.start("Please Wait . . ."),e.details.user_id=APPMarket.user_id,r.sendRequest({},e.link.lists+"/"+e.vars.hash_id,"GET").then(function(a){var t,i;return"error"===a.data.status?(e.alertMsg({msg:a.data.message}),e.blockUI.stop()):(t=a.data.data,i=[],angular.forEach(t.screenshots,function(e,a){return i[a]={id:e.id,name:e.original_name,link:e.image_link,position:e.position}}),t.screenshots=i,e.details=t,e.details.is_enabled=1===e.details.is_enabled,e.details.is_featured=1===e.details.is_featured,e.blockUI.stop())})["catch"](function(a){if("error"===a.data.status)return e.alertMsg({msg:"No query results found, You will be redirected back in 2 seconds..."}),t(function(){return window.location.href=e.link.root},2e3)})},e.grabAndroidDetail=function(){var a;try{return o.validateObj(e.details,["app_id"]),e.blockUI.start("Please Wait . . ."),e.details.user_id=APPMarket.user_id,r.sendRequest({app_id:e.details.app_id},e.link.app_android_detail,"POST").then(function(a){var t,s,r;return"error"===a.data.status?(e.alertMsg({msg:a.data.message}),e.blockUI.stop()):(t=a.data.data,r=[],angular.forEach(t.screenshots,function(e,a){return r[a]={name:"Screenshot From Google #"+ ++a,link:e,position:a}}),s={is_enabled:!0,app_id:t.app_id,title:t.title,description:t.description,image_url:t.cover_image,link:t.app_link,developer_link:t.developer.link,developer_name:t.developer.name,screenshots:r,image_app:{}},t.title&&(s.seo_title=t.title),t.description&&(s.seo_descriptions=i("truncateStr")(t.description,155)),angular.extend(e.details,s),e.blockUI.stop())})["catch"](function(a){var t,i;return t="No results found","error"===a.data.status&&(t=null!=(i=a.data)?i.message:void 0),e.alertMsg({msg:t}),e.blockUI.stop()})}catch(t){return a=t,e.alertMsg({msg:a})}},k=a.$on("file:uploading",function(a,i,s,r){return t(function(){return"app-image"===s?e.details.image_app=i:"app-version"===s?(angular.isUndefined(e.apkFiles)&&(e.apkFiles={}),e.apkFiles.file=i):"app-version-update"===s?(angular.isUndefined(e.apkFile)&&(e.apkFile={}),e.apkFile.file=i):void 0})}),c=a.$on("file:upload-in-array",function(i,s,r){return t(function(){var t;return t=s.file,angular.isUndefined(e.details.screenshots)&&(e.details.screenshots=[]),angular.forEach(t,function(t,i){var s,r;return r=_h.randomKey(12),t.identifier=r,_.contains(["image/gif","image/jpeg","image/jpg","image/png"],t.type)?(s=new FileReader,s.onload=function(e){return a.$emit("image:preview",e.target.result,r)},s.readAsDataURL(t),e.details.screenshots.push(t)):e.alertMsg({msg:"Upload Image only"})})})}),d=a.$on("image:preview",function(a,t,i){var s;s=_.findWhere(e.details.screenshots,{identifier:i}),s.preview=t,e.$$phase||e.$apply()}),u=a.$on("upload:complete",function(a,i,s){var r;return r=JSON.parse(p.dataObj[s].xhr.response),"error"===r.status?(e.alertMsg({msg:r.message}),angular.isDefined(e.blockUI)&&e.blockUI.stop(),!1):(angular.isDefined(e.versionBlockUI)&&e.versionBlockUI[s].stop(),angular.isDefined(e.myBlockUI)&&e.myBlockUI.stop(),angular.isDefined(e.blockUI)&&e.blockUI.stop(),e.alertMsg({msg:"Successfully submitted apps, Redirecting after two(2) seconds.",success:!0}),t(function(){return window.location.href=e.link.submitapps_list},2e3))}),e.$on("$destroy",function(){return c(),k(),u(),abortData(),d()}),e.update=function(){var a,t;e.details.hash_id=e.vars.hash_id,e.details.is_enabled=e.details.is_enabled===!0?1:0,e.details.is_featured=e.details.is_featured===!0?1:0,(e.apkFiles.file.name||e.apkFiles.app_link)&&(e.details.apk_file_upload=e.apkFiles),e.blockUI.start("Please Wait . . .");try{return t=o.objectToFormData(e.details),p.upload(e.link.app_update,t,[])}catch(i){return a=i,e.alertMsg({msg:a})}},e.create=function(){var a,t;e.details.user_id=APPMarket.user_id,e.details.hash_id=e.vars.hash_id,e.details.is_enabled=e.details.is_enabled===!0?1:0,e.details.is_featured=e.details.is_featured===!0?1:0,(e.apkFiles.file.name||e.apkFiles.app_link)&&(e.details.apk_file_upload=e.apkFiles),e.blockUI.start("Please Wait . . .");try{return o.validateObj(e.details,["app_id","title","description","image_app","categories","user_id"]),t=o.objectToFormData(e.details),p.upload(e.link.lists,t,[])}catch(i){return a=i,e.alertMsg({msg:a}),e.blockUI.stop()}},e.createApkItem=function(){return e.apkFiles.app_link||e.apkFiles.file?e.update():(e.alertMsg({msg:"Apk Link URL download required or Upload your own apk file."}),!1)},e.updateApkItem=function(a,t){var i;return e.apkFile.file.name&&(a.apk_file_upload=e.apkFile),angular.isUndefined(e.versionBlockUI)&&(e.versionBlockUI=[]),e.versionBlockUI[t]=e.blockui("version_"+t),e.versionBlockUI[t].start("Updating APK Information. . ."),i=o.objectToFormData(a),p.upload(e.link.app_version_update,i,e.versionBlockUI,t)},e.removeApkItem=function(a){var t;return t={title:"Please Confirm",text:_h.sprintf("Do you want to delete this apk version (<strong>%s</strong>)?",a.app_version),html:!0,showCancelButton:!0,cancelButtonText:"Cancel"},l.swal(t,function(t){if(t&&a.id)return e.deleteFile(e.link.app_remove_apk+"/"+a.id)})},e.alertMsg=function(e){var a,t;return t={title:"System Response",msg:"Problem in your request!"},a=angular.merge(t,e),a.success===!0?l.success(a.title,a.msg):l.error(a.title,a.msg)},e.removeItem=function(a,t){return angular.isDefined(t)?"apk-update"===t?e.apkFile.file={}:void 0:(a.id&&e.deleteFile(e.link.app_remove_upload+"/"+a.id),"app-image"===a.upload_type&&(e.details.app_image=""),t=e.details.screenshots.indexOf(a),e.details.screenshots.splice(t,1))},e.deleteFile=function(a){return r.sendRequest({},a,"POST").then(function(e){return window.location.reload()},function(a){return alert(a.data.message),e.myBlockUI.stop()})},e.blockui=function(e){return s.instances.get(e)},n}())}])}).call(this);