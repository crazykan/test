(function(){APPMarket.Backend.BackendApp.controller("AdsController",["$scope","$rootScope","$timeout","ApiFactory","ListingService","blockUI","SystemFactory","UploaderFactory","SweetAlertService",function(e,t,s,a,r,n,l,o,i){var c;return c=function(){function t(){e.resources=APPMarket.Resources,e.vars=APPMarket.Vars,e.link={lists:e.resources.index,save:e.resources.save},e.blockUITable=e.blockui("blockui-table"),e.blockUINew=e.blockui("blockui-new"),e.blockui=e.blockui("blockui-effect"),e.details={},e.isEdit=!1,e.pagePresetKey="iqcms-ads",e=angular.extend(e,r,{getCollections:function(t){return e.getOrderLists(t)}}),e.loadCollections(),e.adsBlockLists=[],e.adsPlacements={},e.adsArray=e.vars.adsArray,e.adsPlacement=e.vars.adsPlacement}return e.$watch("adsBlockLists",function(t,s){if(t!==s)return angular.forEach(e.adsArray,function(t,s){var a;return a=_.findWhere(e.adsBlockLists,{id:t.advertisement_blocks_id}),e.adsPlacements[t.identifier]=a})}),e.loadAdsBlock=function(){var t;return e.blockui.start("Please wait..."),t=e.link.lists+"?return=all",a.sendRequest({},t,"GET").success(function(t){return"error"===t.status?console.log("error"):e.adsBlockLists=t.data,e.blockui.stop()})},e.loadCollections=function(){return s(function(){var t;return t=_h.get(e.pagePresetKey)||1,""===e.details.search&&""===e.details.letter||(t=1),e.getCollections(t)})},e.getOrderLists=function(t){var a,r;return t=t||1,e.blockUITable.start("Please Wait . . ."),_h.set(e.pagePresetKey,t),a="&per_page=30",r=e.link.lists+"?page="+t+a,e.requestData(r,"GET").success(function(t){return null!=t.data?angular.bind(e,e.dataHandler(t)):(_h.set(e.pagePresetKey,1),e.data=[],e.range=[],e.totalPages=0),s(function(){return e.blockUITable.stop()},500)})},t}(),e.clearBlock=function(){return e.details={},e.isEdit=!1},e.updateData=function(t){return e.blockUINew.start("Please Wait . . ."),a.sendRequest(e.details,e.link.lists+"/"+t.id,"PUT").then(function(t){return"error"===t.data.status?e.alertMsg({msg:t.data.message}):window.location.reload(),e.blockUINew.stop()})},e.editData=function(t){return e.isEdit=!0,e.details=t},e.addData=function(){var t;return e.blockUINew.start("Please Wait . . ."),t=e.link.adsBlockUrl,a.sendRequest(e.details,e.link.lists,"POST").then(function(t){return"error"===t.data.status?e.alertMsg({msg:t.data.message}):window.location.reload(),e.blockUINew.stop()},function(t){return"error"===t.data.status&&e.alertMsg({msg:t.data.message}),e.blockUINew.stop()})},e.delRequest=function(t){return e.blockUITable.start("Please Wait . . ."),a.sendRequest({},e.link.lists+"/"+t.id,"DELETE").then(function(t){return"error"===t.data.status?e.alertMsg({msg:t.data.message}):(e.alertMsg({msg:t.data.message,success:!0}),e.loadCollections()),e.blockUITable.stop()})},e.delModal=function(t){var s;return s={title:"Please Confirm",text:_h.sprintf("Do you want to delete this block (<strong>%s</strong>)?",t.title),html:!0,showCancelButton:!0,cancelButtonText:"Cancel"},i.swal(s,function(s){if(s)return e.delRequest(t)})},e.alertMsg=function(e){var t,s;return s={title:"System Response",msg:"Problem in your request!"},t=angular.merge(s,e),t.success===!0?i.success(t.title,t.msg):i.error(t.title,t.msg)},e.blockui=function(e){return n.instances.get(e)},new c}])}).call(this);