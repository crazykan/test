(function(){APPMarket.Backend.BackendApp.controller("GeneralController",["$scope","$timeout","$rootScope","ApiFactory","ListingService","SystemFactory","blockUI","SweetAlertService","UploaderFactory",function(e,a,t,s,r,o,n,l,u){var i;return new(i=function(){function r(){e.resources=APPMarket.Resources,e.vars=APPMarket.Vars,e.link={lists:e.resources.index,validateApi:e.resources.validateApi,uploadLogo:e.resources.uploadLogo},e.blockUI=e.blockui("blockui-effect"),e.details=[],e.upload={},e.lists()}var i,c;return c=t.$on("file:uploading",function(t,s,r,o){return a(function(){if("app-image"===r)return e.upload.file=s})}),i=t.$on("upload:complete",function(a,t,s){var r;return r=JSON.parse(u.dataObj[s].xhr.response),"error"===r.status?(e.alertMsg({msg:r.message}),angular.isDefined(e.blockUI)&&e.blockUI.stop(),!0):(e.alertMsg({msg:r.message,success:!0}),window.location.reload())}),e.uploadImage=function(a){var t;return angular.isUndefined(e.upload.image_key)&&(e.upload.image_key={}),e.upload.image_key=a,t=o.objectToFormData(e.upload),u.upload(e.link.uploadLogo,t,[])},e.deleteImage=function(a){return e.blockUI.start("Please Wait . . ."),s.sendRequest(a,e.link.uploadLogo,"POST").then(function(a){return"error"===a.data.status?(e.alertMsg({msg:a.data.message}),e.blockUI.stop()):(window.location.reload(),e.blockUI.stop())})},e.lists=function(){return e.blockUI.start("Please Wait . . ."),s.sendRequest({},e.link.lists,"GET").then(function(a){var t;return"error"===a.data.status?(e.alertMsg({msg:a.data.message}),e.blockUI.stop()):(t=a.data.data,e.details=t,e.blockUI.stop())})},e.update=function(a){var t;return t={},angular.forEach(a,function(e){return _.each(e.lists,function(e){return t[e.key]=e.value})}),e.blockUI.start("Please Wait . . ."),s.sendRequest(t,e.link.lists+"/saving","PUT").then(function(a){var t;return"error"===a.data.status?(e.alertMsg({msg:a.data.message}),e.blockUI.stop()):(t=a.data.data,e.alertMsg({msg:a.data.message,success:!0})),e.blockUI.stop()})},e.validatePurchaseCode=function(){var a,t,r,o;return a=e.details.apk_download_via_api.lists,o="",t="",_.each(a,function(e){if("purchase_code"===e.key&&(o=e.value),"buyer_username"===e.key)return t=e.value}),o&&t?(r={purchase_code:o,buyer_username:t},e.blockUI.start("Please Wait . . ."),s.sendRequest(r,e.link.validateApi,"POST").then(function(t){var s;return"error"===t.data.status?(e.alertMsg({msg:t.data.message}),e.blockUI.stop()):(s=t.data.data,_.each(a,function(e){"download_api_url"===e.key&&(e.value=s.api)}),e.details.apk_download_via_api.lists=a,e.alertMsg({msg:t.data.message,success:!0})),e.blockUI.stop()})):e.alertMsg({msg:"No purchase code and buyer username found"})},e.alertMsg=function(e){var a,t;return t={title:"System Response",msg:"Problem in your request!"},a=angular.merge(t,e),a.success===!0?l.success(a.title,a.msg):l.error(a.title,a.msg)},e.blockui=function(e){return n.instances.get(e)},r}())}])}).call(this);