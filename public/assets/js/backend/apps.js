(function(){APPMarket.Backend.BackendApp.controller("AppsController",["$scope","$rootScope","$timeout","blockUI","ApiFactory","ListingService","SystemFactory","SweetAlertService","UploaderFactory",function(e,t,a,s,r,i,n,l,o){var d;return new(d=function(){function d(){e.resources=APPMarket.Resources,e.vars=APPMarket.Vars,e.link={root:e.resources.root,lists:e.resources.index,app_update:e.resources.app_update,app_version_update:e.resources.app_version_update,app_search:e.resources.app_search,app_import:e.resources.app_import,app_android_detail:e.resources.app_android_detail,app_remove_upload:e.resources.app_remove_upload,app_remove_apk:e.resources.app_remove_apk},e.blockUI=e.blockui("blockui-effect"),e.blockSearchUI=e.blockui("search-result"),e.details={},e.per_page=50,e.letters=e.vars.alpha,e.categoryObj={list:[]},0===e.vars.hash_id&&0===e.vars.is_create?(e.details={per_page:50,search:"",letter:""},e.pagePresetKey="appmarket-page",e=angular.extend(e,i,{getCollections:function(t){return e.getOrderLists(t)}}),e.loadCollections()):1===e.vars.is_google_play?(e.categories=e.vars.categories,e.appLists=[],e.details={search:"",letter:""}):(e.uploads={},e.categories=e.vars.categories,e.apkFile=e.apkFiles={app_version:"",signature:"",sha_1:"",description:"",app_link:"",file:{}},e.details={image_app:{},screenshots:[],is_enabled:!0,app_id:"",title:"",description:"",image_url:"",link:"",developer_link:"",developer_name:"",apk_files:[],versions:[],custom:[]},e.tempInputOptions={identifier:"text",key:"",value:""},e.inputTypes=["text","textarea"],0===e.vars.is_create&&e.getDetail())}var p,u,c,g;return e.loadCollections=function(){return a(function(){var t;return t=_h.get(e.pagePresetKey)||1,""!==e.details.search&&(t=1),e.getCollections(t)})},e.getOrderLists=function(t){var s,r,i,n;return t=t||1,e.blockUI.start("Please Wait . . ."),_h.set(e.pagePresetKey,t),e.details.per_page=angular.isUndefined(e.details.per_page)?e.per_page:e.details.per_page,e.details.search=angular.isUndefined(e.details.search)?"":e.details.search,n="&search="+e.details.search,r="&per_page="+e.details.per_page,s="&letter="+e.details.letter,i=e.link.lists+"?page="+t+n+s+r,e.requestData(i,"GET").success(function(t){return null!=t.data?angular.bind(e,e.dataHandler(t)):(_h.set(e.pagePresetKey,1),e.data=[],e.range=[],e.totalPages=0),a(function(){return e.blockUI.stop()},500)})},e.delRequest=function(t,a){return e.blockUI.start("Please Wait . . ."),r.sendRequest({},e.link.lists+"/"+t.id,"DELETE").then(function(t){return"error"===t.data.status?e.alertMsg({msg:t.data.message}):(e.alertMsg({msg:t.data.message,success:!0}),window.location.href=e.link.root),e.blockUI.stop()})},e.delModal=function(t,a){var s;return s={title:"Please Confirm",text:_h.sprintf("Do you want to delete this page (<strong>%s</strong>)?",t.title),html:!0,showCancelButton:!0,cancelButtonText:"Cancel"},l.swal(s,function(s){if(s)return e.delRequest(t,a)})},e.grabDetailAndSave=function(t){return e.blockUI.start("Please Wait . . ."),e.details.user_id=APPMarket.user_id,r.sendRequest({app_id:t,is_save:!0},e.link.app_android_detail,"POST").then(function(t){var a;return"error"===t.data.status?(e.alertMsg({msg:t.data.message}),e.blockUI.stop()):(a=t.data.data,console.log(a),e.blockUI.stop())})},e.addCustomOptions=function(){var t;if(console.log("$scope.details.custom",e.details.custom),console.log("_.size($scope.tempInputOptions)",_.size(e.tempInputOptions)),_.size(e.tempInputOptions)>0)return t={identifier:"text",key:"",value:""},e.details.custom.push(t)},e.getDetail=function(){return e.blockUI.start("Please Wait . . ."),e.details.user_id=APPMarket.user_id,r.sendRequest({},e.link.lists+"/"+e.vars.hash_id,"GET").then(function(t){var a,s;return"error"===t.data.status?(e.alertMsg({msg:t.data.message}),e.blockUI.stop()):(a=t.data.data,s=[],angular.forEach(a.screenshots,function(e,t){return s[t]={id:e.id,name:e.original_name,link:e.image_link,position:e.position}}),a.screenshots=s,e.details=a,e.details.is_enabled=1===e.details.is_enabled,e.details.is_featured=1===e.details.is_featured,""===e.details.custom&&(e.details.custom=[]),e.details.custom=JSON.parse(e.details.custom),e.blockUI.stop())})["catch"](function(t){if("error"===t.data.status)return e.alertMsg({msg:"No query results found, You will be redirected back in 2 seconds..."}),a(function(){return window.location.href=e.link.root},2e3)})},e.grabAndroidDetail=function(){return e.blockUI.start("Please Wait . . ."),e.details.user_id=APPMarket.user_id,r.sendRequest({app_id:e.details.app_id},e.link.app_android_detail,"POST").then(function(t){var a,s,r;return"error"===t.data.status?(e.alertMsg({msg:t.data.message}),e.blockUI.stop()):(a=t.data.data,r=[],angular.forEach(a.screenshots,function(e,t){return r[t]={name:"Screenshot From Google #"+ ++t,link:e,position:t}}),s={is_enabled:!0,app_id:a.app_id,title:a.title,description:a.description,image_url:a.cover_image,link:a.app_link,developer_link:a.developer.link,developer_name:a.developer.name,screenshots:r,reviews:a.reviews,ratings:a.rate_score,ratings_total:a.ratings_total,published_date:a.published_date,rating_histogram:a.rating_histogram,installs:a.installs,required_android:a.required_android,image_app:{}},angular.extend(e.details,s),e.blockUI.stop())})["catch"](function(t){var a,s;return a="No results found","error"===t.data.status&&(a=null!=(s=t.data)?s.message:void 0),e.alertMsg({msg:a}),e.blockUI.stop()})},g=t.$on("file:uploading",function(t,s,r,i){return a(function(){return"app-image"===r?e.details.image_app=s:"app-version"===r?(angular.isUndefined(e.apkFiles)&&(e.apkFiles={}),e.apkFiles.file=s):"app-version-update"===r?(angular.isUndefined(e.apkFile)&&(e.apkFile={}),e.apkFile.file=s):void 0})}),c=t.$on("file:upload-in-array",function(s,r,i){return a(function(){var a;return a=r.file,angular.isUndefined(e.details.screenshots)&&(e.details.screenshots=[]),angular.forEach(a,function(a,s){var r,i;return i=_h.randomKey(12),a.identifier=i,_.contains(["image/gif","image/jpeg","image/jpg","image/png"],a.type)?(r=new FileReader,r.onload=function(e){return t.$emit("image:preview",e.target.result,i)},r.readAsDataURL(a),e.details.screenshots.push(a)):e.alertMsg({msg:"Upload Image only"})})})}),p=t.$on("image:preview",function(t,a,s){var r;r=_.findWhere(e.details.screenshots,{identifier:s}),r.preview=a,e.$$phase||e.$apply()}),u=t.$on("upload:complete",function(t,a,s){var r;return r=JSON.parse(o.dataObj[s].xhr.response),console.log(r),"error"===r.status?(e.alertMsg({msg:r.message}),angular.isDefined(e.blockUI)&&e.blockUI.stop(),!1):(angular.isDefined(e.versionBlockUI)&&e.versionBlockUI[s].stop(),angular.isDefined(e.myBlockUI)&&e.myBlockUI.stop(),angular.isDefined(e.blockUI)&&e.blockUI.stop(),angular.isDefined(r.data.backend_detail_url)?window.location.href=r.data.backend_detail_url:void 0)}),e.$on("$destroy",function(){return c(),g(),u(),abortData(),p()}),e.update=function(){var t,a;e.details.hash_id=e.vars.hash_id,e.details.is_enabled=e.details.is_enabled===!0?1:0,e.details.is_featured=e.details.is_featured===!0?1:0,(e.apkFiles.file.name||e.apkFiles.app_link)&&(e.details.apk_file_upload=e.apkFiles),e.blockUI.start("Please Wait . . .");try{return a=n.objectToFormData(e.details),o.upload(e.link.app_update,a,[])}catch(s){return t=s,e.alertMsg({msg:t})}},e.create=function(){var t,a;e.details.user_id=APPMarket.user_id,e.details.hash_id=e.vars.hash_id,e.details.is_enabled=e.details.is_enabled===!0?1:0,e.details.is_featured=e.details.is_featured===!0?1:0,(e.apkFiles.file.name||e.apkFiles.app_link)&&(e.details.apk_file_upload=e.apkFiles),e.blockUI.start("Please Wait . . .");try{return a=n.objectToFormData(e.details),o.upload(e.link.lists,a,[])}catch(s){return t=s,e.alertMsg({msg:t})}},e.searchFromGooglePlay=function(){return e.blockSearchUI.start("Please Wait . . ."),e.isSearching=!0,r.sendRequest(e.details,e.link.app_search,"POST").then(function(t){var a;return"error"===t.data.status?e.alertMsg({msg:t.data.message}):(a=t.data.data,e.appLists=a,e.paginate=a.paginate),e.isSearching=!1,e.blockSearchUI.stop()})},e.importApp=function(t){var a,s;if(e.categoryObj.list.length<1)return e.alertMsg({msg:"Please select atleast one category where to import your apps / games."}),!1;for(e.blockSearchUI.start("Please Wait . . ."),a=[],s=0;s<e.categoryObj.list.length;)a[s]=e.categoryObj.list[s].id,s++;return t.user_id=APPMarket.user_id,r.sendRequest({data:t,categories:a},e.link.app_import,"POST").then(function(t){return"error"===t.data.status?e.alertMsg({msg:t.data.message}):e.alertMsg({msg:t.data.message,success:!0}),e.blockSearchUI.stop()},function(t){if("error"===t.data.status)return e.alertMsg({msg:res.data.message}),e.blockSearchUI.stop()})},e.searchBulkAction=function(){var t,a,s,i,n,o;if(e.categoryObj.list.length<1)return e.alertMsg({msg:"Please select atleast one category where to import your apps / games."}),!1;for(t=[],s=0;s<e.appLists.length;)e.appLists[s].is_checked===!0&&(n=e.appLists[s],n.user_id=APPMarket.user_id,t[s]=n),s++;for(a=[],i=0;i<e.categoryObj.list.length;)a[i]=e.categoryObj.list[i].id,i++;return o={title:"Please Confirm",text:"Do you want to import all app/games selected?",html:!0,showCancelButton:!0,cancelButtonText:"Cancel"},l.swal(o,function(s){if(s)return e.blockSearchUI.start("Please Wait . . ."),r.sendRequest({data:t,categories:a,is_bulk:!0},e.link.app_import,"POST").then(function(t){return"error"===t.data.status?e.alertMsg({msg:t.data.message}):(e.alertMsg({msg:t.data.message,success:!0}),e.appLists=[]),e.blockSearchUI.stop()},function(t){if("error"===t.data.status)return e.alertMsg({msg:res.data.message}),e.blockSearchUI.stop()})})},e.searchSelectAll=function(){var t,a;for(t=0,a=[];t<e.appLists.length;)e.appLists[t].is_checked=e.details.allItemsSelected,a.push(t++);return a},e.searchSelectedItem=function(){var t;for(t=0;t<e.appLists.length;)e.appLists[t].is_checked===!1&&(e.details.allItemsSelected=!1),t++;return e.details.allItemsSelected=!0},e.createApkItem=function(){return e.apkFiles.app_link||e.apkFiles.file?e.update():(e.alertMsg({msg:"Apk Link URL download required or Upload your own apk file."}),!1)},e.updateApkItem=function(t,a){var s;return e.apkFile.file.name&&(t.apk_file_upload=e.apkFile),angular.isUndefined(e.versionBlockUI)&&(e.versionBlockUI=[]),e.versionBlockUI[a]=e.blockui("version_"+a),e.versionBlockUI[a].start("Updating APK Information. . ."),s=n.objectToFormData(t),o.upload(e.link.app_version_update,s,e.versionBlockUI,a)},e.removeApkItem=function(t){var a;return a={title:"Please Confirm",text:_h.sprintf("Do you want to delete this apk version (<strong>%s</strong>)?",t.app_version),html:!0,showCancelButton:!0,cancelButtonText:"Cancel"},l.swal(a,function(a){if(a&&t.id)return e.deleteFile(e.link.app_remove_apk+"/"+t.id)})},e.alertMsg=function(e){var t,a;return a={title:"System Response",msg:"Problem in your request!"},t=angular.merge(a,e),t.success===!0?l.success(t.title,t.msg):l.error(t.title,t.msg)},e.removeItem=function(t,a){return angular.isDefined(a)?"apk-update"===a?e.apkFile.file={}:void 0:(t.id&&e.deleteFile(e.link.app_remove_upload+"/"+t.id),"app-image"===t.upload_type&&(e.details.app_image=""),a=e.details.screenshots.indexOf(t),e.details.screenshots.splice(a,1))},e.deleteFile=function(t){return r.sendRequest({},t,"POST").then(function(e){return window.location.reload()},function(t){return alert(t.data.message),e.myBlockUI.stop()})},e.search=function(){return e.loadCollections()},e.clearAll=function(){return e.details={search:"",letter:"",per_page:50},e.loadCollections()},e._slug=function(e){return e.toString().toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")},e.perPageChange=function(t){return e.details.per_page=t,e.loadCollections()},e.statusChange=function(){return e.isEdit=!1},e.letterFilter=function(t){return e.details.letter=t,e.loadCollections()},e.blockui=function(e){return s.instances.get(e)},d}())}])}).call(this);