(function(){APPMarket.Backend.BackendApp.controller("PageController",["$scope","$timeout","blockUI","ApiFactory","ListingService","SystemFactory","SweetAlertService",function(e,t,a,s,r,n,l){var i;return i=function(){function a(){e.resources=APPMarket.Resources,e.vars=APPMarket.Vars,e.link={root:e.resources.root,lists:e.resources.index,bulk_deletion:e.resources.bulk_deletion},e.blockUI=e.blockui("blockui-effect"),e.details={},e.per_page=20,e.parent_page_lists=e.vars.page_lists,e.status_lists=e.vars.status_lists,e.details.parent_page=_.findWhere(e.vars.page_lists,{id:0}),0===e.vars.hash_id&&0===e.vars.is_create?(e.pagePresetKey="APPMarket-page",e=angular.extend(e,r,{getCollections:function(t){return e.getOrderLists(t)}}),e.loadCollections(),e.details.allItemsSelected=!1,e.dd_actions={}):(e.details.is_enabled=!0,0===e.vars.is_create&&e.getDetail())}return e.getDetail=function(){return e.blockUI.start("Please Wait . . ."),e.details.user_id=APPMarket.user_id,s.sendRequest({},e.link.lists+"/"+e.vars.hash_id,"GET").then(function(t){var a;return"error"===t.data.status?(e.alertMsg({msg:t.data.message}),e.blockUI.stop()):(a=t.data.data,e.details=a,e.details.is_enabled=1===e.details.is_enabled,e.blockUI.stop())})["catch"](function(a){if("error"===a.data.status)return e.alertMsg({msg:"No query results found, You will be redirected back in 2 seconds..."}),t(function(){return window.location.href=e.link.root},2e3)})},e.create=function(t){var a;try{return e.details.user_id=APPMarket.user_id,n.validateObj(e.details,["title","content","user_id"]),e.details.is_draft=angular.isDefined(t)?t:0,e.details.is_enabled=e.details.is_enabled===!0?1:0,e.blockUI.start("Please Wait . . ."),s.sendRequest(e.details,e.link.lists,"POST").then(function(t){var a;return"error"===t.data.status?(e.alertMsg({msg:t.data.message}),e.blockUI.stop()):(a=t.data,window.location.href=a.data.backend_detail_url,e.blockUI.stop())})}catch(r){return a=r,e.alertMsg({msg:a})}},a}(),e.update=function(t){var a;try{return e.details.user_id=APPMarket.user_id,n.validateObj(e.details,["title","slug","content","user_id"]),e.details.is_draft=angular.isDefined(t)?t:0,e.details.is_enabled=e.details.is_enabled===!0?1:0,e.blockUI.start("Please Wait . . ."),s.sendRequest(e.details,e.link.lists+"/"+e.vars.hash_id,"PUT").then(function(t){var a;return"error"===t.data.status?(e.alertMsg({msg:t.data.message}),e.blockUI.stop()):(a=t.data,window.location.reload(),e.blockUI.stop())})}catch(r){return a=r,e.alertMsg({msg:a})}},e.loadCollections=function(){return t(function(){var t;return t=_h.get(e.pagePresetKey)||1,""!==e.details.search&&(t=1),e.getCollections(t)})},e.getOrderLists=function(a){var s,r,n;return a=a||1,e.blockUI.start("Please Wait . . ."),_h.set(e.pagePresetKey,a),e.details.per_page=angular.isUndefined(e.details.per_page)?e.per_page:e.details.per_page,e.details.search=angular.isUndefined(e.details.search)?"":e.details.search,n="&search="+e.details.search,s="&per_page="+e.details.per_page,r=e.link.lists+"?page="+a+n+s,e.requestData(r,"GET").success(function(a){return null!=a.data?angular.bind(e,e.dataHandler(a)):(_h.set(e.pagePresetKey,1),e.data=[],e.range=[],e.totalPages=0),t(function(){return e.blockUI.stop()},500)})},e.delRequest=function(t){return e.blockUI.start("Please Wait . . ."),s.sendRequest({},e.link.lists+"/"+t.id,"DELETE").then(function(t){return"error"===t.data.status?e.alertMsg({msg:t.data.message}):(e.alertMsg({msg:t.data.message,success:!0}),window.location.href=e.link.root),e.blockUI.stop()})},e.delModal=function(t){var a;return a={title:"Please Confirm",text:_h.sprintf("Do you want to delete this page (<strong>%s</strong>)?",t.title),html:!0,showCancelButton:!0,cancelButtonText:"Cancel"},l.swal(a,function(a){if(a)return e.delRequest(t)})},e.alertMsg=function(e){var t,a;return a={title:"System Response",msg:"Problem in your request!"},t=angular.merge(a,e),t.success===!0?l.success(t.title,t.msg):l.error(t.title,t.msg)},e.search=function(){return e.loadCollections()},e.clearAll=function(){return e.details={search:"",letter:"",per_page:20},e.loadCollections()},e._slug=function(e){return e.toString().toLowerCase().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")},e.perPageChange=function(){return e.loadCollections()},e.statusChange=function(){return e.isEdit=!1},e.blockui=function(e){return a.instances.get(e)},new i}])}).call(this);