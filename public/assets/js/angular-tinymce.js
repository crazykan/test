angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function(e,t,n,i,r,o){o=o||{};var u="ui-tinymce";return o.baseUrl&&(tinymce.baseURL=o.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(a,c,s,d){function m(e){e?(f(),$&&$.getBody().setAttribute("contenteditable",!1)):(f(),$&&!$.settings.readonly&&$.getDoc()&&$.getBody().setAttribute("contenteditable",!0))}function f(){$||($=tinymce.get(s.id))}if(i.tinymce){var l,$,v=d[0],g=d[1]||null,y={debounce:!0},b=function(t){var n=t.getContent({format:y.format}).trim();n=r.trustAsHtml(n),v.$setViewValue(n),e.$$phase||a.$digest()};s.$set("id",u+"-"+(new Date).valueOf()),l={},angular.extend(l,a.$eval(s.uiTinymce));var p=function(e){var t;return function(i){n.cancel(t),t=n(function(){return function(e){e.isDirty()&&(e.save(),b(e))}(i)},e)}}(400),h={setup:function(t){t.on("init",function(){v.$render(),v.$setPristine(),v.$setUntouched(),g&&g.$setPristine()}),t.on("ExecCommand change NodeChange ObjectResized",function(){return y.debounce?void p(t):(t.save(),void b(t))}),t.on("blur",function(){c[0].blur(),v.$setTouched(),e.$$phase||a.$digest()}),t.on("remove",function(){c.remove()}),o.setup&&o.setup(t,{updateView:b}),l.setup&&l.setup(t,{updateView:b})},format:l.format||"html",selector:"#"+s.id};angular.extend(y,o,l,h),n(function(){y.baseURL&&(tinymce.baseURL=y.baseURL);var e=tinymce.init(y);e&&"function"==typeof e.then?e.then(function(){m(a.$eval(s.ngDisabled))}):m(a.$eval(s.ngDisabled))}),v.$formatters.unshift(function(e){return e?r.trustAsHtml(e):""}),v.$parsers.unshift(function(e){return e?r.getTrustedHtml(e):""}),v.$render=function(){f();var e=v.$viewValue?r.getTrustedHtml(v.$viewValue):"";$&&$.getDoc()&&($.setContent(e),$.fire("change"))},s.$observe("disabled",m),a.$on("$tinymce:refresh",function(e,n){var i=s.id;if(angular.isUndefined(n)||n===i){var r=c.parent(),o=c.clone();o.removeAttr("id"),o.removeAttr("style"),o.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),r.append(t(o)(a))}}),a.$on("$destroy",function(){f(),$&&($.remove(),$=null)})}}}}]);